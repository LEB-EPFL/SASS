Simulation Models
=================

Shot noise and sensor noise
---------------------------

There are two noise models employed by SASS: photon shot noise—which
accounts for the quantum nature of fluorescence emission—and sensor
noise. Sensor noise is based on the models described in these two
documents:

- `Basden, Haniff, and Mackay, "Photon counting strategies with
  low-light-level CCDs," Mon. Not. R. Aston. Soc. 345,
  1187-1197 (2003)
  <http://onlinelibrary.wiley.com/doi/10.1046/j.1365-8711.2003.07020.x/abstract>`_
- `The EMVA 1288 Standard
  <http://www.emva.org/standards-technology/emva-1288/>`_

Sensor noise models in SASS currently do not account for spatial
non-uniformities or defect pixels; each pixel is assumed independent
from all other pixels. Furthermore, each pixel has identical
statistical properties to all other pixels.

Additional assumptions employed in SASS include:

- The sensor is linear.
- Noise sources are wide sense stationary with respect to time and
  space.
- Only quantum efficiency is wavelength-dependent.
- Only dark current is temperature dependent.

.. image:: ../_images/camera_noise_model.png
   :scale: 50%
   :align: center
   :alt: Schematic of the image sensor temporal noise model.

Shot noise
++++++++++

Photon shot noise (or just shot noise) represents fluctuations in the
number of photons incident on a pixel between different frame
exposures. It is due to the quantum nature of fluorescence emission
and is not dependent upon any properties of the image sensor.

Let :math:`\mu_p` represent the mean number of photons incident upon a
pixel during the exposure of a given frame. The number of
photoelectrons :math:`\mu_e` generated by these photons is given by 

.. math::

   \mu_e = \eta \mu_p

where :math:`\eta` is the quantum efficiency of the sensor and, in
general, depends on the wavelength of the light.

Fluorescence emission is well-modeled as a Poisson process. Under this
condition, the mean number of photoelectrons will be equivalent to the
variance :math:`sigma_e^2` of the number of photoelectrons generated
over time.

.. math::

   \sigma_e^2 = \mu_e

Sensor temporal noise
+++++++++++++++++++++

Within the sensor, photoelectrons are converted to analog-to-digital
units (ADU) through a step-wise process involving

1. the amplification of the signal and the addition of multiplication
   noise (for cameras possessing a multiplication register),
2. the addition of dark noise, which consists of readout noise and
   dark current noise,
3. the conversion of electrons to voltages by multiplication with a
   constant system gain factor,
4. and quantization of the voltage to discrete ADU values and
   summation with a constant baseline value.

The number of photoelectrons that is generated within the pixels of an
electron multiplying CCD (EMCCD) is amplified within a serial register
via electron avalanche multiplication. This process is random and
introduces a multiplicative noise that is modeled as a gamma
distribution :math:`\Gamma \left( \mu_e, g^{-1} \right)` where
:math:`g^{-1}` is the inverse value of the camera's EM gain. (Note
that in some notations the second parameter of the gamma distribution
is denoted directly by the gain, not its inverse.) Sensors such as
sCMOS cameras that lack a serial multiplication register are modeled
in SASS by setting the EM gain value to 0.

Following the multiplication register, dark current noise is added to
the signal to account for thermally excited electrons within the
pixels. Dark current is modeled as a zero-mean Gaussian distribution
whose standard deviation is a free parameter. Typically, the value for
this parameter is found by assuming that dark current is also a
Poisson process whose variance is equivalent to the mean number of
dark current electrons :math:`\mu_I t_{exp}`. Here, :math:`\mu_I` is
the dark current in electrons per time and :math:`t_{exp}` is the
exposure time of the frame. :math:`\mu_I` is dependent on temperature
in general. Dark current is often negligible in microscopy
experiments, so it may often be safely ignored.

The total number of amplified photoelectrons and dark current
electrons are then readout as a voltage, which introduces a readout
noise. Readout noise is modeled as a zero-mean Gaussian distribution
whose standard deviation is also a free parameter. The value for this
parameter is often given on camera specification sheets as a median or
root-mean-square (RMS) number of electrons. (`RMS readout noise is
preferred for sCMOS cameras because of pixel-to-pixel variation in the
values
<http://camera.hamamatsu.com/us/en/technical_guides/read_noise/index.html>`_.)
Some camera manufacturers will combine dark current and readout noise
into a single noise source known as dark noise with mean :math:`\mu_d`
and variance :math:`\sigma_d^2`.

After addition of the readout noise, the voltage signal is amplified
by another free parameter found on camera specification sheets, the
system gain :math:`K`. Finally, the signal is quantized into discrete
ADUs and optionally summed with a constant baseline :math:`b` to
prevent negative pixel values. This baseline is often about 100
ADU. The quantization noise is a uniform distribution with variance
:math:`\sigma_q^2 = \frac{1}{12} \, ADU^2`. It is automatically
accounted for in the code by converting from double to integer data
types.


